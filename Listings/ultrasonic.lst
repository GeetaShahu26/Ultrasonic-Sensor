C51 COMPILER V9.60.7.0   ULTRASONIC                                                        09/10/2025 08:42:17 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE ULTRASONIC
OBJECT MODULE PLACED IN .\Objects\ultrasonic.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ultrasonic.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listing
                    -s\ultrasonic.lst) TABS(2) OBJECT(.\Objects\ultrasonic.obj)

line level    source

   1          #include<reg51.h>
   2          #include <stdio.h>
   3          
   4          // Define LCD connections
   5          #define display_port P2      // Data pins connected to port 2 on microcontroller
   6          
   7          sbit rs = P3^2;  // RS pin connected to pin 2 of port 3
   8          sbit rw = P3^3;  // RW pin connected to pin 3 of port 3
   9          sbit e  = P3^4;  // E pin connected to pin 4 of port 3
  10          
  11          // Define Ultrasonic Sensor Pins (using Port 1 to avoid conflict with LCD on Port 2)
  12          sbit Trigger_pin = P1^6;
  13          sbit Echo_pin    = P1^7;
  14          
  15          // Function to create delay in ms
  16          void msdelay(unsigned int time) {
  17   1          unsigned int i, j;
  18   1          for(i = 0; i < time; i++)
  19   1              for(j = 0; j < 1275; j++);
  20   1      }
  21          
  22          // Delay of ~10 microseconds
  23          void Delay_us() {
  24   1          TL0 = 0xF5;
  25   1          TH0 = 0xFF;
  26   1          TR0 = 1;
  27   1          while (TF0 == 0);
  28   1          TR0 = 0;
  29   1          TF0 = 0;
  30   1      }
  31          
  32          // LCD command function
  33          void lcd_cmd(unsigned char command) {
  34   1          display_port = command;
  35   1          rs = 0;
  36   1          rw = 0;
  37   1          e = 1;
  38   1          msdelay(1);
  39   1          e = 0;
  40   1      }
  41          
  42          // LCD data function
  43          void lcd_data(unsigned char disp_data) {
  44   1          display_port = disp_data;
  45   1          rs = 1;
  46   1          rw = 0;
  47   1          e = 1;
  48   1          msdelay(1);
  49   1          e = 0;
  50   1      }
  51          
  52          // LCD initialization
  53          void lcd_init() {
  54   1          lcd_cmd(0x38);  // 2 lines, 5x7 matrix
C51 COMPILER V9.60.7.0   ULTRASONIC                                                        09/10/2025 08:42:17 PAGE 2   

  55   1          msdelay(10);
  56   1          lcd_cmd(0x0E);  // Display on, cursor blinking
  57   1          msdelay(10);
  58   1          lcd_cmd(0x01);  // Clear display
  59   1          msdelay(10);
  60   1          lcd_cmd(0x06);  // Cursor shift right
  61   1          msdelay(10);
  62   1          lcd_cmd(0x80);  // Cursor to first line
  63   1          msdelay(10);
  64   1      }
  65          
  66          // Send a string to LCD
  67          void lcd_string(unsigned char *str) {
  68   1          while(*str) {
  69   2              lcd_data(*str++);
  70   2          }
  71   1      }
  72          
  73          // Move cursor to position
  74          void lcd_cmd_xy(unsigned char row, unsigned char col) {
  75   1          unsigned char pos;
  76   1          if(row == 1)
  77   1              pos = 0x80 + (col - 1);
  78   1          else
  79   1              pos = 0xC0 + (col - 1);
  80   1          lcd_cmd(pos);
  81   1      }
  82          
  83          // Timer initialization
  84          void init_timer() {
  85   1          TMOD = 0x01; // Timer0 mode1
  86   1          TF0 = 0;
  87   1          TR0 = 0;
  88   1      }
  89          
  90          // Send 10us trigger pulse
  91          void send_trigger_pulse() {
  92   1          Trigger_pin = 1;
  93   1          Delay_us();
  94   1          Trigger_pin = 0;
  95   1      }
  96          
  97          void main() {
  98   1          float distance_measurement, value;
  99   1          unsigned int timer_count;
 100   1          unsigned char distance_in_cm[10];
 101   1      
 102   1          lcd_init();                // Initialize LCD
 103   1          init_timer();              // Initialize Timer
 104   1      
 105   1          lcd_cmd_xy(1,1);
 106   1          lcd_string("Distance:");
 107   1      
 108   1          while(1) {
 109   2              send_trigger_pulse();            // Send 10us pulse
 110   2      
 111   2              while(!Echo_pin);                // Wait for echo HIGH
 112   2              TR0 = 1;                         // Start Timer0
 113   2      
 114   2              while(Echo_pin && !TF0);         // Wait until echo LOW or timeout
 115   2              TR0 = 0;                         // Stop timer
 116   2      
C51 COMPILER V9.60.7.0   ULTRASONIC                                                        09/10/2025 08:42:17 PAGE 3   

 117   2              timer_count = (TH0 << 8) | TL0;  // Read timer value
 118   2              TH0 = 0;                         // Clear timer
 119   2              TL0 = 0;
 120   2      
 121   2              value = 34300.0 / 2.0;           // Sound speed (cm/s) / 2 (round trip)
 122   2              distance_measurement = (float)timer_count * 1.085e-6 * value; // (clock period × count × speed)
 123   2      
 124   2              sprintf(distance_in_cm, "%4.2f cm", distance_measurement);
 125   2      
 126   2              lcd_cmd_xy(2,1);
 127   2              lcd_string("            ");      // Clear line
 128   2              lcd_cmd_xy(2,1);
 129   2              lcd_string(distance_in_cm);
 130   2      
 131   2              msdelay(200);  // Small delay between measurements
 132   2          }
 133   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    362    ----
   CONSTANT SIZE    =     32    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      23
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
